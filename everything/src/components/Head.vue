<template>
  <div class="head">
    <Menu mode="horizontal" :theme="theme1" active-name="1">
      <MenuItem name="1">
        <Icon type="ios-paper" />
        内容管理
      </MenuItem>
      <MenuItem name="2">
        <Icon type="ios-people" />
        用户管理
      </MenuItem>
      <Submenu name="3">
        <template slot="title">
            <Icon type="ios-stats" />
            统计分析
        </template>
        <MenuGroup title="使用">
            <MenuItem name="3-1">新增和启动</MenuItem>
            <MenuItem name="3-2">活跃分析</MenuItem>
            <MenuItem name="3-3">时段分析</MenuItem>
        </MenuGroup>
        <MenuGroup title="留存">
            <MenuItem name="3-4">用户留存</MenuItem>
            <MenuItem name="3-5">流失用户</MenuItem>
        </MenuGroup>
      </Submenu>
      <MenuItem name="4">
          <Icon type="ios-construct" />
          综合设置
      </MenuItem>
    </Menu>
    <!-- <ul class="nav">
      <li v-for="(item,index) in menuList" @click="active=item.title" :class="active===item.title?'active':''" :key="`menu-${index}`">
        <router-link :to="item.name">
            <span v-html="item.icon"></span>
            <span>{{item.menuName}}</span>
        </router-link>
      </li>
    </ul> -->
  </div>
</template>

<script>
import { catalogs, publish } from '../libs/api'
import { getToken, quit } from '../libs/user'
import topic from './topic'
export default {
  name: 'head',
  components: { topic },
  inject: ['app'],
  data () {
    return {
      theme1: 'dark',
      token: getToken(),
      menuList: [
        {menuName:'推荐', name: '/main'},
        {menuName:'关注', name: '/main'},
        {menuName:'消息', name: '/main'},
      ],
      dropList: [
        {dropName:'个人中心',name:'/mine/personal',svg:`<svg t="1571642670423" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5923" width="16" height="16"><path d="M511.980046 563.763944c120.088052 0 217.426985-97.328699 217.426985-217.408565s-97.338932-217.408565-217.426985-217.408565c-120.067586 0-217.389122 97.329722-217.389122 217.408565S391.912459 563.763944 511.980046 563.763944zM511.980046 191.053314c85.773526 0 155.310252 69.538773 155.310252 155.302065 0 85.763292-69.536726 155.291832-155.310252 155.291832-85.756129 0-155.291832-69.52854-155.291832-155.291832C356.688213 260.592087 426.223916 191.053314 511.980046 191.053314zM832.934918 760.708432c0-90.75805-36.597523-152.034649-95.398744-210.320123l-0.649799 0.661056c-11.195993-10.677177-28.64848-11.07115-40.315194-0.425695-12.416797 11.352559-13.568017 30.944779-2.587941 43.764759 2.217505 2.579755 4.76042 4.680603 7.505951 6.311753 31.989575 32.486902 55.021128 65.143673 65.286935 107.417475 1.617847 9.092076 3.601015 21.050432 4.973268 32.462343 0.545422 6.553253 1.050935 13.106506 1.050935 20.13048 0 10.515494-0.766456 20.818141-1.960655 31.010271l1.960655 0c0 22.818705-17.913998 41.330314-40.075741 41.330314-22.12081 0-92.103698-0.618077-92.103698-0.618077 0.101307 0.225127 0.223081 0.406253 0.304945 0.618077L511.352759 833.051063l-0.001023-0.110517L389.447315 832.940546c0.077771-0.212848 0.218988-0.406253 0.300852-0.618077 0 0-72.305793 0.618077-95.157243 0.618077-22.889313 0-41.411155-18.541285-41.411155-41.413202l2.0241 0c-1.213641-10.200316-2.0241-20.532639-2.0241-31.058366 0-7.04751 0.528026-13.606903 1.074472-20.170388 1.435699-11.44261 3.496637-23.412223 5.154393-32.523741 10.605545-42.351574 34.403554-75.069743 67.472717-107.621113 2.828418-1.633197 5.447059-3.735068 7.726985-6.317892 11.384281-12.841469 10.19213-32.466436-2.648316-43.839461-12.069897-10.674107-30.091342-10.280134-41.671075 0.426719l-0.669242-0.660032c-60.762899 58.385758-98.555643 119.785154-98.555643 210.704886 0 6.460132 0.546446 12.769838 0.951675 19.119453-0.447185 3.952009-0.951675 7.873318-0.951675 11.938913 0 57.18235 46.346561 103.527888 103.527888 103.527888l438.133665 0c55.344492 0 100.210329-46.26265 100.210329-103.33346 0-4.064572-0.50449-7.977695-0.928139-11.911284C832.370053 773.45985 832.934918 767.161401 832.934918 760.708432zM511.980046 708.702987c-17.127076 0-31.038924 13.899568-31.038924 31.058366 0 17.147542 13.910824 31.049157 31.038924 31.049157 17.164938 0 31.05939-13.901615 31.05939-31.049157C543.039435 722.602555 529.146007 708.702987 511.980046 708.702987zM511.980046 605.175099c-17.127076 0-31.038924 13.912871-31.038924 31.058366 0 17.147542 13.910824 31.05939 31.038924 31.05939 17.164938 0 31.05939-13.911848 31.05939-31.05939C543.039435 619.08797 529.146007 605.175099 511.980046 605.175099z" p-id="5924" fill="#db6f6a"></path></svg>`},
        {dropName:'账号设置',name:'/mine/setting',svg:`<svg t="1571642762628" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6732" width="16" height="16"><path d="M512 442.181818a69.818182 69.818182 0 1 1-69.818182 69.818182 69.818182 69.818182 0 0 1 69.818182-69.818182m0-69.818182a139.636364 139.636364 0 1 0 139.636364 139.636364 139.636364 139.636364 0 0 0-139.636364-139.636364z" p-id="6733" fill="#db6f6a"></path><path d="M364.450909 139.636364a12.334545 12.334545 0 0 1 6.516364 2.327272l51.665454 38.167273a148.945455 148.945455 0 0 0 178.734546 0l51.665454-38.167273a11.636364 11.636364 0 0 1 6.516364-2.327272h2.792727a403.083636 403.083636 0 0 1 90.763637 53.061818 12.334545 12.334545 0 0 1 3.723636 10.938182l-6.749091 64.465454A151.272727 151.272727 0 0 0 837.818182 423.796364l58.414545 26.298181a11.170909 11.170909 0 0 1 6.981818 8.61091 410.298182 410.298182 0 0 1 0 106.821818 11.636364 11.636364 0 0 1-6.981818 8.610909L837.818182 600.203636a151.04 151.04 0 0 0-88.669091 155.229091l6.749091 64.232728a12.334545 12.334545 0 0 1-3.723637 10.938181A389.12 389.12 0 0 1 709.585455 861.090909a405.643636 405.643636 0 0 1-46.545455 23.272727h-2.792727a12.334545 12.334545 0 0 1-6.516364-2.327272l-51.665454-38.167273a148.945455 148.945455 0 0 0-178.734546 0l-52.363636 38.167273a11.636364 11.636364 0 0 1-6.516364 2.327272h-2.792727a403.083636 403.083636 0 0 1-90.763637-53.061818 12.334545 12.334545 0 0 1-3.723636-10.938182l6.749091-64.465454A151.272727 151.272727 0 0 0 186.181818 600.203636l-59.345454-26.298181a11.170909 11.170909 0 0 1-6.981819-8.61091 410.298182 410.298182 0 0 1 0-106.821818 11.636364 11.636364 0 0 1 6.981819-8.610909L186.181818 423.796364a151.04 151.04 0 0 0 88.669091-155.229091l-6.749091-64.232728a12.334545 12.334545 0 0 1 3.723637-10.938181A389.12 389.12 0 0 1 314.414545 162.909091a405.643636 405.643636 0 0 1 46.545455-23.272727h2.792727m0-69.818182a76.8 76.8 0 0 0-29.556363 5.818182A495.010909 495.010909 0 0 0 279.272727 103.330909a474.530909 474.530909 0 0 0-51.432727 34.909091 82.850909 82.850909 0 0 0-30.254545 73.541818l6.981818 64.232727a82.152727 82.152727 0 0 1-47.941818 84.014546l-58.181819 26.065454a81.454545 81.454545 0 0 0-47.709091 63.301819 478.021818 478.021818 0 0 0 0 124.974545 81.454545 81.454545 0 0 0 47.476364 63.301818l58.414546 26.298182a82.152727 82.152727 0 0 1 47.941818 84.014546l-6.981818 64.465454a82.152727 82.152727 0 0 0 30.487272 73.541818 465.454545 465.454545 0 0 0 106.821818 62.370909 76.8 76.8 0 0 0 29.556364 5.818182 81.454545 81.454545 0 0 0 48.174546-16.058182l51.432727-38.4a80.523636 80.523636 0 0 1 95.883636 0l51.432727 38.4a81.454545 81.454545 0 0 0 48.174546 16.058182 76.8 76.8 0 0 0 29.556364-5.818182A495.010909 495.010909 0 0 0 744.727273 920.669091a474.530909 474.530909 0 0 0 51.432727-34.909091 82.850909 82.850909 0 0 0 30.254545-73.541818l-6.981818-64.232727a82.152727 82.152727 0 0 1 47.941818-84.014546l58.181819-26.065454a81.454545 81.454545 0 0 0 46.545454-63.301819 478.021818 478.021818 0 0 0 0-124.974545 81.454545 81.454545 0 0 0-46.545454-63.301818l-58.414546-26.298182a82.152727 82.152727 0 0 1-47.941818-84.014546l6.981818-64.465454a82.152727 82.152727 0 0 0-30.254545-73.541818 465.454545 465.454545 0 0 0-106.821818-62.370909A76.8 76.8 0 0 0 659.549091 69.818182a81.454545 81.454545 0 0 0-48.174546 16.058182l-51.432727 38.4a80.523636 80.523636 0 0 1-95.883636 0l-51.432727-38.4A81.454545 81.454545 0 0 0 364.450909 69.818182z" p-id="6734" fill="#db6f6a"></path></svg>`}
      ],
      topicModal: false,
      loading: true
    }
  },
  beforeCreate() {
    bus.$on('token', res=> this.token=res);
  },
  methods: {
    search() { alert("s"); },
    publish() {
      let data = this.$refs.topic.topicData;      
      let topicForm = this.$refs.topic.$refs.topicForm;
      
      topicForm.validate(valid => {
        if (valid) {
          publish(data).then(res => {
            this.$Message.success(res.data.msg)
            this.topicModal = false
          }).catch(err => {
            console.log('发表辩题出错：', err)
          })
          this.topicModal = false;
          topicForm.resetFields();
        } else {
          this.$Message.error('有必填项未填');
        }
        this.loading = false;
        this.$nextTick(() => {
          this.loading = true;
        })
      });
    },
    cancel() {
      let topicForm = this.$refs.topic.$refs.topicForm
      topicForm.resetFields();
    },
    quit(){
      quit(getToken()).then(res => {
        this.token='';
        localStorage.token="";
        localStorage.user="";
        alert("退出成功！");
      }).catch(err => {
        console.log(err);
      })
    }
  },
}
</script>
